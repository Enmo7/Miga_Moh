<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المراقب الصحي الذكي</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
       body {
          height: 100vh;
          margin: 0;
          background: linear-gradient(to bottom, #40e0d0, #ffffff);
          font-family: 'Cairo', sans-serif;
          text-align: center;
      }
      h1 {
          color: #333;
          font-size: 48px;
          font-weight: bold;
          padding-top: 50px;
      }
      .logo {
          position: absolute;
          top: 20px;
          left: 20px;
          width: 100px;
      }
      .box {
          position: absolute;
          top: 160px;
          background-color: #006f6a;
          border-radius: 30px;
          padding: 20px;
          width: 250px;
          color: white;
          font-weight: bold;
      }
      .box-right { right: 100px; }
      .box-left { left: 100px; }
      .table-right, .table-left {
          position: absolute;
          top: 280px;
          width: 40%;
          border-collapse: collapse;
          text-align: center;
      }
      .table-right { right: 20px; }
      .table-left { left: 20px; }
      td { padding: 20px; font-size: 18px; }
      .image-cell img { width: 50px; height: 50px; }
      .menu-button {
          position: absolute;
          top: 20px;
          right: 20px;
          background-color: #006f6a;
          color: white;
          padding: 10px;
          border-radius: 5px;
          cursor: pointer;
      }
      .menu-options {
          display: none;
          position: absolute;
          top: 60px;
          right: 20px;
          background-color: white;
          border: 1px solid #006f6a;
          border-radius: 5px;
      }
      .menu-options div { padding: 10px; cursor: pointer; color: #006f6a; }
    </style>
    <script>
    function fetchSensorData() {
        $.ajax({
            url: "https://huggingface.co/spaces/EngTig/IOT_ess",  //http://127.0.0.1:7860/api/predict/ استبدل بالرابط الفعلي لـ Gradio إذا كان يعمل عن بُعد
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({}),
            success: function(response) {
                $("#heart_rate_value").text(response["معدل ضربات القلب"]);
                $("#spo2_value").text(response["نسبة الأكسجين في الدم"]);
                $("#temperature_value").text(response["درجة الحرارة"]);
                $("#gsr_value").text(response["معدل التعرق"]);
                $("#sugar_value").text(response["مستوى السكر"]);
                $("#seizure_status").text(response["حالة النوبات"]);
                $("#fall_status").text(response["حالة السقوط"]);
            },
            error: function(xhr, status, error) {
                console.error("خطأ في جلب البيانات:", error);
            }
        });
    }

    // تحديث البيانات كل 5 ثوانٍ
    setInterval(fetchSensorData, 5000);

    // جلب البيانات عند تحميل الصفحة لأول مرة
    $(document).ready(fetchSensorData);
</script>

</head>
<body>
    <img src="images/logo.png" alt="Logo" class="logo">
    <h1>المراقب الصحي الذكي</h1>
    <div class="box box-right"><p>بيانات القياسات الحيوية</p></div>
    <div class="box box-left"><p>المؤشرات والمتابعات الصحية</p></div>
    <div class="table-right">
        <table>
            <tbody>
                <tr><td class="image-cell"><img src="images/heart.png"></td><td>معدل ضربات القلب</td><td id="heart_rate_value"></td></tr>
                <tr><td class="image-cell"><img src="images/spo2.png"></td><td>نسبة الأكسجين</td><td id="spo2_value"></td></tr>
                <tr><td class="image-cell"><img src="images/temp.png"></td><td>درجة الحرارة</td><td id="temperature_value"></td></tr>
            </tbody>
        </table>
    </div>
    <div class="table-left">
        <table>
            <tbody>
                <tr><td class="image-cell"><img src="images/fall.png"></td><td>اكتشاف السقوط</td><td id="fall_prediction_value"></td></tr>
                <tr><td class="image-cell"><img src="images/seizure.png"></td><td>النوبات العصبية</td><td id="seizure_prediction_value"></td></tr>
            </tbody>
        </table>
    </div>
    <div class="menu-button" onclick="toggleMenu()">خيارات</div>
    <div class="menu-options" id="menu-options">
        <div onclick="window.location.href='data.html'">سجل البيانات</div>
        <div onclick="window.location.href='reports.html'">التقارير المجمعة</div>
    </div>
    <script>
        $(document).ready(function() {
            function updateData() {
                $.getJSON('data.json', function(data) {
                    $("#heart_rate_value").text(data.heart_rate + " bpm");
                    $("#spo2_value").text(data.spo2 + "%");
                    $("#temperature_value").text(data.temperature + "°C");
                    $("#fall_prediction_value").text(data.fall_prediction);
                    $("#seizure_prediction_value").text(data.seizure_prediction);
                });
            }
            updateData();
            setInterval(updateData, 15000);
        });
        function toggleMenu() {
            var menu = document.getElementById('menu-options');
            menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
        }
    </script>
</body>
</html>
